{% extends "layout/base_content_only.html" %}

{% load static %}

{% block title %}LoopLabel | ì§€êµ¬ì˜ íšŒë³µì„ ì´ì–´ì£¼ëŠ” ë¼ë²¨{% endblock title %}


{% block style %}
    <link rel="stylesheet" href="{% static 'css/mainapp/index.css' %}">
{% endblock style %}


{% block content %}
    <div id="top-area">
        <span class="profile-image-wrap">
            <a href="javascript:;" class="profile-image">
                <img src="https://www.icreta.com/files/attach/images/319/275/055/8e2c1590a474a9afb78c4cb23a9af5b2.jpg">
            </a>
            <p class="dot green"></p>
        </span>
        <span class="profile-name-wrap">
            <div>ì§„ê²½</div>
            <div class="profile-state">Active now</div>
        </span>
    </div>
    <div id="chat-area">
        <div class="chat ai">
            <img class="profile-image" src="https://www.icreta.com/files/attach/images/319/275/055/8e2c1590a474a9afb78c4cb23a9af5b2.jpg">
            <div class="msg">
                {# Text ë¶€ë¶„ ########################################}
                <div class="text">
<pre>
ê°ì‚¬í•©ë‹ˆë‹¤, ì§€í›ˆë‹˜! ğŸ‰
ë§ì”€í•´ì£¼ì‹  ì •ë³´ ê¼¼ê¼¼íˆ í™•ì¸í–ˆì–´ìš” ğŸ˜Š
ì´ì œ ì§€í›ˆë‹˜ê»˜ ë”± ë§ëŠ” ìŠ¤íƒ€ì¼ì„ ì¶”ì²œí•´ë“œë¦´ê²Œìš”!

í˜¹ì‹œ ì§€ê¸ˆ ì–´ë–¤ ìƒí™©ì´ë‚˜ ìŠ¤íƒ€ì¼ì´ í•„ìš”í•˜ì‹ ê°€ìš”? ì˜ˆë¥¼ ë“¤ë©´ ì´ëŸ° ê²ƒë“¤ì´ ìˆì–´ìš”:

âœ¨ ë°ì´íŠ¸ë£©
ğŸ‘” ì˜¤í”¼ìŠ¤ë£©
ğŸ‘Ÿ ìºì£¼ì–¼ ë°ì¼ë¦¬
ğŸ‚ ê³„ì ˆë³„ ì¶”ì²œ (ê°€ì„ ì½”ë”” ë“±)

ì›í•˜ì‹œëŠ” ë°©í–¥ì„ ì•Œë ¤ì£¼ì‹œë©´, ì§„ê²½ì´ê°€ ì„¼ìŠ¤ ìˆê²Œ ì½”ë””ë¥¼ ê³¨ë¼ë“œë¦´ê²Œìš” ğŸ’«
</pre>
                </div>
                {# ê²€ìƒ‰ëœ ë£© ì¡°íšŒ ë¶€ë¶„ ########################################}
                <div class="style_result">
                    <ul>
                        <li>
                            <a class="look-link" href="{% url "mainapp:detail" 1 %}">
                                <div>
                                    <img class="look-image" src="{% static "images/dummy/dummy_look_1.jpg" %}">
                                    <div class="inner-shadow"></div>
                                </div>
                                <span class="look-name">ìŠ¤ë§ˆíŠ¸ ìºì£¼ì–¼</span>
                                <span class="look-desc">ğŸ’¼ í´ë˜ì‹í•˜ê³  ë‹¨ì •í•œ ì¬í™œìš©ìš¸ ìˆ˜íŠ¸ë£©</span>
                            </a>
                        </li>
                        <li>
                            <a class="look-link" href="{% url "mainapp:detail" 2 %}">
                                <div>
                                    <img class="look-image" src="{% static "images/dummy/dummy_look_2.jpg" %}">
                                    <div class="inner-shadow"></div>
                                </div>
                                <span class="look-name">ë¯¸ë‹ˆë©€ í…Œì¼ëŸ¬ë“œ</span>
                                <span class="look-desc">âœ¨ ê°€ë³ê³  í™œë™ì„± ë†’ì€ ë¦¬ì‚¬ì´í´ ì…‹ì—…ë£©</span>
                            </a>
                        </li>
                        <li>
                            <a class="look-link" href="{% url "mainapp:detail" 3 %}">
                                <div>
                                    <img class="look-image" src="{% static "images/dummy/dummy_look_1.jpg" %}">
                                    <div class="inner-shadow"></div>
                                </div>
                                <span class="look-name">ìŠ¤ë§ˆíŠ¸ ìºì£¼ì–¼</span>
                                <span class="look-desc">ğŸ’¼ í´ë˜ì‹í•˜ê³  ë‹¨ì •í•œ ì¬í™œìš©ìš¸ ìˆ˜íŠ¸ë£©</span>
                            </a>
                        </li>
                    </ul>
                </div>
                {# ëª©ì†Œë¦¬ ì¬ìƒ ë¶€ë¶„ ########################################}
                <div class="voice">
{#                    <div class="play_btn"><img src="{% static "images/chatroom/play_btn.svg" %}"></div>#}
{#                    <ul class="sound-wave"></ul>#}
{#                    <span class="time-laps">00:34</span>#}
                    <audio controls disableRemotePlayback="false" loop="false" src="{% static "dummy/dummy_sound.mp3" %}">ë¸Œë¼ìš°ì €ê°€ ì˜¤ë””ì˜¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</audio>
                </div>
{#                <div class="custom-audio-player">#}
{#                    <button id="playPauseButton">Play</button>#}
{#                    <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="1">#}
{#                    <input type="range" id="progressBar" min="0" max="100" value="0">#}
{#                    <span id="currentTime">0:00</span> / <span id="duration">0:00</span>#}
{#                </div>#}
            </div>
            <span class="chat-time">09:27 AM</span>
        </div>
        <div class="chat user">
            <img class="profile-image" src="https://www.icreta.com/files/attach/images/319/275/055/8e2c1590a474a9afb78c4cb23a9af5b2.jpg">
            <div class="msg">
                {# Text ë¶€ë¶„ ########################################}
                <div class="text">
<pre>
ê°ì‚¬í•©ë‹ˆë‹¤, ì§€í›ˆë‹˜! ğŸ‰
ë§ì”€í•´ì£¼ì‹  ì •ë³´ ê¼¼ê¼¼íˆ í™•ì¸í–ˆì–´ìš” ğŸ˜Š
ì´ì œ ì§€í›ˆë‹˜ê»˜ ë”± ë§ëŠ” ìŠ¤íƒ€ì¼ì„ ì¶”ì²œí•´ë“œë¦´ê²Œìš”!

í˜¹ì‹œ ì§€ê¸ˆ ì–´ë–¤ ìƒí™©ì´ë‚˜ ìŠ¤íƒ€ì¼ì´ í•„ìš”í•˜ì‹ ê°€ìš”? ì˜ˆë¥¼ ë“¤ë©´ ì´ëŸ° ê²ƒë“¤ì´ ìˆì–´ìš”:

âœ¨ ë°ì´íŠ¸ë£©
ğŸ‘” ì˜¤í”¼ìŠ¤ë£©
ğŸ‘Ÿ ìºì£¼ì–¼ ë°ì¼ë¦¬
ğŸ‚ ê³„ì ˆë³„ ì¶”ì²œ (ê°€ì„ ì½”ë”” ë“±)

ì›í•˜ì‹œëŠ” ë°©í–¥ì„ ì•Œë ¤ì£¼ì‹œë©´, ì§„ê²½ì´ê°€ ì„¼ìŠ¤ ìˆê²Œ ì½”ë””ë¥¼ ê³¨ë¼ë“œë¦´ê²Œìš” ğŸ’«
</pre>
                </div>
                {# ê²€ìƒ‰ëœ ë£© ì¡°íšŒ ë¶€ë¶„ ########################################}
                <div class="style_result">
                    <ul>
                        <li>
                            <a class="look-link" href="{% url "mainapp:detail" 1 %}">
                                <div>
                                    <img class="look-image" src="{% static "images/dummy/dummy_look_1.jpg" %}">
                                    <div class="inner-shadow"></div>
                                </div>
                                <span class="look-name">ìŠ¤ë§ˆíŠ¸ ìºì£¼ì–¼</span>
                                <span class="look-desc">ğŸ’¼ í´ë˜ì‹í•˜ê³  ë‹¨ì •í•œ ì¬í™œìš©ìš¸ ìˆ˜íŠ¸ë£©</span>
                            </a>
                        </li>
                        <li>
                            <a class="look-link" href="{% url "mainapp:detail" 2 %}">
                                <div>
                                    <img class="look-image" src="{% static "images/dummy/dummy_look_2.jpg" %}">
                                    <div class="inner-shadow"></div>
                                </div>
                                <span class="look-name">ë¯¸ë‹ˆë©€ í…Œì¼ëŸ¬ë“œ</span>
                                <span class="look-desc">âœ¨ ê°€ë³ê³  í™œë™ì„± ë†’ì€ ë¦¬ì‚¬ì´í´ ì…‹ì—…ë£©</span>
                            </a>
                        </li>
                        <li>
                            <a class="look-link" href="{% url "mainapp:detail" 3 %}">
                                <div>
                                    <img class="look-image" src="{% static "images/dummy/dummy_look_1.jpg" %}">
                                    <div class="inner-shadow"></div>
                                </div>
                                <span class="look-name">ìŠ¤ë§ˆíŠ¸ ìºì£¼ì–¼</span>
                                <span class="look-desc">ğŸ’¼ í´ë˜ì‹í•˜ê³  ë‹¨ì •í•œ ì¬í™œìš©ìš¸ ìˆ˜íŠ¸ë£©</span>
                            </a>
                        </li>
                    </ul>
                </div>
                {# ëª©ì†Œë¦¬ ì¬ìƒ ë¶€ë¶„ ########################################}
                <div class="voice">
{#                    <div class="play_btn"><img src="{% static "images/chatroom/play_btn.svg" %}"></div>#}
{#                    <ul class="sound-wave"></ul>#}
{#                    <span class="time-laps">00:34</span>#}
                    <audio controls disableRemotePlayback="false" loop="false" src="{% static "dummy/dummy_sound.mp3" %}">ë¸Œë¼ìš°ì €ê°€ ì˜¤ë””ì˜¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</audio>
                </div>
{#                <div class="custom-audio-player">#}
{#                    <button id="playPauseButton">Play</button>#}
{#                    <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="1">#}
{#                    <input type="range" id="progressBar" min="0" max="100" value="0">#}
{#                    <span id="currentTime">0:00</span> / <span id="duration">0:00</span>#}
{#                </div>#}
            </div>
            <span class="chat-time">09:27 AM</span>
        </div>
    </div>
    <div id="typing-area">
        <a href="javascript:alert('ì•ˆë˜ì§€ë¡±');"><img class="attach_icon" src="{% static "images/chatroom/attach.svg" %}"></a>
        <div class="chatbox">
            <textarea class="user_input" rows="2" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”."></textarea>
            <a href="javascript:;"><img class="send_chat_icon" src="{% static "images/chatroom/send_chat.svg" %}"></a>
        </div>
        <a href="javascript:alert('ì•ˆë˜ì§€ë¡±');"><img class="mic_icon" src="{% static "images/chatroom/mic.svg" %}"></a>
    </div>

    <template id="tmpl-chat">
        <div class="chat">
            <img class="profile-image" src="">
            <div class="msg">
                {# Text ë¶€ë¶„ ########################################}
                <div class="text"></div>
                {# ê²€ìƒ‰ëœ ë£© ì¡°íšŒ ë¶€ë¶„ ########################################}
                <div class="style_result">
                    <ul></ul>
                </div>
                {# ëª©ì†Œë¦¬ ì¬ìƒ ë¶€ë¶„ ########################################}
                <div class="voice">
                    <audio controls disableRemotePlayback="false" loop="false" src="{% static "dummy/dummy_sound.mp3" %}">ë¸Œë¼ìš°ì €ê°€ ì˜¤ë””ì˜¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</audio>
                </div>
            </div>
            <span class="chat-time">09:27 AM</span>
        </div>
    </template>
    <template id="tmpl-style">
        <li>
            <a class="look-link" href="">
                <div>
                    <img class="look-image" src="">
                    <div class="inner-shadow"></div>
                </div>
                <span class="look-name">ìŠ¤ë§ˆíŠ¸ ìºì£¼ì–¼</span>
                <span class="look-desc">ğŸ’¼ í´ë˜ì‹í•˜ê³  ë‹¨ì •í•œ ì¬í™œìš©ìš¸ ìˆ˜íŠ¸ë£©</span>
            </a>
        </li>
    </template>
{% endblock content %}


{% block script %}
    <script>
        const $room      = document.getElementById("chat-area");
        const $tmplChat  = document.getElementById("tmpl-chat").content;
        const $tmplStyle = document.getElementById("tmpl-style").content;
        const TYPE       = {USER:"user", AI:"ai"};
        const curTime = () => {
            let now  = new Date();
            let hour = now.getHours();
            let min  = now.getMinutes();
            let ampm;

            ampm = hour >= 12 ? "PM" : "AM";
            hour = (hour < 10 ? "0" : "") + hour;
            min  = (min  < 10 ? "0" : "") + min;
            return `${hour}:${min} ${ampm}`;
        }
        const addChat = (type, msg, list, voice) => {
            let profileImage = "https://www.icreta.com/files/attach/images/319/275/055/8e2c1590a474a9afb78c4cb23a9af5b2.jpg";

            type = Object.values(TYPE).includes(type) ? type : TYPE.AI;
            if( type === TYPE.USER ) {
                profileImage = "user_profile_image.jpg";
            }

            let $chat = $tmplChat.cloneNode(true);
            $chat.querySelector(".chat").classList.add(type);
            $chat.querySelector(".profile-image").src = profileImage;
            $chat.querySelector(".text").innerHTML = msg.replace(/\r/g,"").replace(/\n/g, "<br/>");
            $chat.querySelector(".chat-time").innerText = curTime();

            let $ul = $chat.querySelector("ul");
            list = list || [];
            if( ! list.length )
                $chat.querySelector(".style_result").remove();
            else {
                for(let i in list) {
                    let data = list[i];
                    let $li  = $tmplStyle.cloneNode(true);
                    $li.querySelector(".look-link").href = `/detail/${data["id"]}`;
                    $li.querySelector(".look-image").src = data["image"];
                    $li.querySelector(".look-name").innerText = data["look_name"];
                    $li.querySelector(".look-desc").innerText = data["look_desc"];

                    $ul.appendChild($li);
                }
            }

            if( voice )     $chat.querySelector(".voice audio").src = voice;
            else            $chat.querySelector(".voice").remove();

            $room.appendChild($chat);
        }

        Object.freeze(TYPE);
    </script>

    <script>
        const sendQuery = (msg) => {
            console.log("send :: "+msg)
        }
    </script>

    <script>
        const $userInput = document.querySelector(".user_input");
        const $sendBtn   = document.querySelector(".chatbox a");
        $sendBtn.addEventListener("click", e => {
            const msg = $userInput.value;
            sendQuery(msg);
            addChat(TYPE.USER, msg)
            $userInput.value = "";
        });

        $userInput.addEventListener("keydown", e => {
            let isEnter = e.key === "Enter";
            e.ctrlKey && isEnter && $sendBtn.click();
        });
    </script>
{% endblock script %}