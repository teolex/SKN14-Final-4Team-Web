{% extends "layout/base_content_only.html" %}

{% load static %}

{% block title %}LoopLabel | 지구의 회복을 이어주는 라벨{% endblock title %}


{% block style %}
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="{% static 'css/mainapp/main.css' %}">
{% endblock style %}


{% block content %}
    <div class="app-container">
        <!-- 메인 콘텐츠 -->
        <div class="main-content">
            <!-- Story 탭 콘텐츠 -->
            <div id="story-content" class="tab-content-area{% if main_active_tab == "story" %} active{% endif %}">
                <div class="story-header">
                    <h1><i class="fas fa-leaf me-2"></i>환경 이야기</h1>
                    <p>지구를 위한 작은 실천이 큰 변화를 만듭니다</p>
                </div>

                <div class="story-sub-tabs">
                    <ul class="nav nav-tabs">
                        <li class="nav-item">
                            <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#crisis-tab">
                                <i class="fas fa-exclamation-triangle me-1"></i>위기
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#action-tab">
                                <i class="fas fa-seedling me-1"></i>실천
                            </button>
                        </li>
                    </ul>
                </div>

                <div class="tab-content story-content">
                    <div class="tab-pane fade show active" id="crisis-tab">
                        <div class="card crisis-card">
                            <div class="card-body">
                                <i class="fas fa-temperature-high crisis-icon"></i>
                                <h5 class="card-title text-danger">기후변화 가속화</h5>
                                <p class="card-text">지구 평균 기온이 계속 상승하면서 극한 기후 현상이 빈발하고 있습니다. 빙하가 녹고, 해수면이 상승하며, 생태계가 파괴되고 있어요.</p>
                                <small class="text-muted">출처: IPCC 보고서 2023</small>
                            </div>
                        </div>

                        <div class="card crisis-card">
                            <div class="card-body">
                                <i class="fas fa-trash crisis-icon"></i>
                                <h5 class="card-title text-danger">플라스틱 오염 심각</h5>
                                <p class="card-text">매년 800만 톤의 플라스틱이 바다로 유입되고 있습니다. 미세플라스틱은 이미 우리 식탁까지 올라와 있어요.</p>
                                <small class="text-muted">출처: UN 환경보고서</small>
                            </div>
                        </div>

                        <div class="card crisis-card">
                            <div class="card-body">
                                <i class="fas fa-smog crisis-icon"></i>
                                <h5 class="card-title text-danger">대기오염 증가</h5>
                                <p class="card-text">미세먼지와 온실가스 배출량이 증가하면서 대기 질이 악화되고 있습니다. 건강에 직접적인 영향을 미치고 있어요.</p>
                                <small class="text-muted">출처: WHO 보고서</small>
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="action-tab">
                        <div class="card action-card">
                            <div class="card-body">
                                <i class="fas fa-recycle action-icon"></i>
                                <h5 class="card-title text-success">재활용 실천하기</h5>
                                <p class="card-text">분리수거를 철저히 하고, 재활용 가능한 제품을 선택해보세요. 작은 실천이 큰 변화를 만듭니다.</p>
                                <div class="mt-2">
                                    <span class="badge bg-success me-1">플라스틱</span>
                                    <span class="badge bg-success me-1">종이</span>
                                    <span class="badge bg-success">캔류</span>
                                </div>
                            </div>
                        </div>

                        <div class="card action-card">
                            <div class="card-body">
                                <i class="fas fa-shopping-bag action-icon"></i>
                                <h5 class="card-title text-success">친환경 소비</h5>
                                <p class="card-text">일회용품 사용을 줄이고, 친환경 제품을 선택해보세요. 텀블러, 에코백 사용으로 지구를 지켜주세요.</p>
                                <div class="mt-2">
                                    <span class="badge bg-success me-1">텀블러</span>
                                    <span class="badge bg-success me-1">에코백</span>
                                    <span class="badge bg-success">대나무 빨대</span>
                                </div>
                            </div>
                        </div>

                        <div class="card action-card">
                            <div class="card-body">
                                <i class="fas fa-lightbulb action-icon"></i>
                                <h5 class="card-title text-success">에너지 절약</h5>
                                <p class="card-text">LED 전구 사용, 대기전력 차단, 대중교통 이용 등으로 에너지를 절약하고 탄소발자국을 줄여보세요.</p>
                                <div class="mt-2">
                                    <span class="badge bg-success me-1">LED 전구</span>
                                    <span class="badge bg-success me-1">대중교통</span>
                                    <span class="badge bg-success">멀티탭</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="talk-content" class="tab-content-area{% if main_active_tab == "talk" or main_active_tab == None %} active{% endif %}">
                <div class="chat-container">
                    <div id="top-area">
                        <span class="profile-image-wrap">
                            <div class="profile-image">
                                <img src="https://via.placeholder.com/44x44/20A090/ffffff?text=AI" alt="AI">
                            </div>
                            <span class="dot"></span>
                        </span>
                        <span class="profile-name-wrap">
                            <div>환경 스타일 AI</div>
                            <div class="profile-state">Active now</div>
                        </span>
                    </div>

                    <div id="chat-area">
                        <div class="chat ai">
                            <img class="profile-image" src="https://via.placeholder.com/44x44/20A090/ffffff?text=AI" alt="AI">
                            <div class="msgbox">
                                <div class="talker-name">환경 스타일 AI</div>
                                <div class="msg">
                                    <div class="text">안녕하세요! 저는 친환경 패션을 추천해드리는 AI입니다. 🌱<br><br>지속가능한 패션과 환경을 생각하는 스타일링을 도와드릴게요. 어떤 스타일이 필요하신가요?</div>
                                </div>
                            </div>
                            <span class="chat-time">09:27 AM</span>
                        </div>
                    </div>

                    <div id="typing-area">
                        <button class="attach-btn" onclick="alert('파일 첨부 기능')">
                            <i class="fas fa-paperclip"></i>
                        </button>
                        <div class="chatbox">
                            <textarea class="user_input" rows="1" placeholder="메시지를 입력하세요..."></textarea>
                            <button class="send-btn">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                        <button class="mic-btn" onclick="alert('음성 입력 기능')">
                            <i class="fas fa-microphone"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div id="mypage-content" class="tab-content-area{% if main_active_tab == "mypage" %} active{% endif %}">
                {% include "app/userapp/mypage.html" %}
            </div>
        </div>

        <!-- 고정 GNB -->
        <div class="gnb-container">
            <div class="gnb-tabs">
                <a href="#" class="gnb-tab{% if main_active_tab == "story" %} active{% endif %}" data-tab="story">
                    <i class="fas fa-book-open"></i>
                    <span>Story</span>
                </a>
                <a href="#" class="gnb-tab{% if main_active_tab == "talk" or main_active_tab == None %} active{% endif %}" data-tab="talk">
                    <i class="fas fa-comments"></i>
                    <span>Talk</span>
                </a>
                <a href="#" class="gnb-tab{% if main_active_tab == "mypage" %} active{% endif %}" data-tab="mypage">
                    <i class="fas fa-user"></i>
                    <span>My page</span>
                </a>
            </div>
        </div>
    </div>

    <!-- Chat 템플릿 -->
    <template id="tmpl-chat">
        <div class="chat">
            <img class="profile-image" src="" alt="">
            <div class="msgbox">
                <div class="talker-name"></div>
                <div class="msg">
                    <div class="text"></div>
                    <div class="style_result">
                        <ul></ul>
                    </div>
                    <div class="text optional"></div>
                    <div class="voice">
                        <audio controls disableRemotePlaybook="false" loop="false" src="">브라우저가 오디오를 지원하지 않습니다.</audio>
                    </div>
                </div>
            </div>
            <span class="chat-time"></span>
        </div>
    </template>
    <template id="tmpl-style">
        <li>
            <a class="look-link" href="">
                <div>
                    <img class="look-image" src="">
                    <div class="inner-shadow"></div>
                </div>
                <span class="look-name">스마트 캐주얼</span>
                <span class="look-desc">💼 클래식하고 단정한 재활용울 수트룩</span>
            </a>
        </li>
    </template>
{% endblock content %}


{% block script %}
    <script>
        const AI_INFO = {
            "image" : "{{ last_ai.image }}",
            "name"  : "{{ last_ai.name }}"
        };
        const USER_INFO = {
            "image" : "{{ user.member.photo_url }}",
            "name"  : "{{ user.first_name }}"
        };
        const ASK_API_URL = "{% url "apiapp:ask_api" %}";
    </script>
    <script src="{% static "js/gnb.js" %}"></script>
    <script src="{% static "js/mainapp/main.js" %}"></script>
{% endblock script %}